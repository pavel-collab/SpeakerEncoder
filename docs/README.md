# REAMDE

В этом задании нам нужно было обучить SpeakerEncoder на основе Conformer и AngularMarginLoss для лучшего распознавания различных
спикеров. AngularMargineLoss имеет интуитивную логику, схожую с моделью SVM -- максимизирует зазоры между объектами в гиперпространстве
различных спикеров. 

После реализации AngularMarginLoss и функции для подсчета метрики EER было необходимо получить значение ERR <= 4.5%. Для этого
нужно было подобрать оптимальные гиперпараметры модели. В задании мы не варьируем гиперпараметры, связанные с обработкой звука, только
параметры самой модели.

## Подбор гиперпараметров

Для подбора оптимальных гиперпараметров мы использовали пакет optuna, который производит оптимизацию в пространстве гиперпараметров.
Проследить ход подбора экспериментов можно по графикам:

__График истории оптимизации__ -- показывает, как программа спускалась в пространстве гиперпараметров, получая значения оптимизируемой метрики (в нашем случае -- значение EER). В идеале, график должен выходить на плато

![График истории оптимизации](/docs/images/history.png)

__График важности параметров__ -- пояснение не требуется. Как видно из графика, в основном на значение точности является сложность сверточной модели конформера.

![График важности параметров](/docs/images/param_importance.png)

__Контурный график__ -- двумерная карта, которая показывает взаимосвязь между двумя гиперпараметрами и тем, как их комбинация влияет на целевую функцию. Обычно "хорошие области" это холмы, но поскольку при вычислении ERR чем меньше - тем лучшее, в нашем случае "хорошие области" это впадины. Эти графики показывают наиболее интересные области значений гиперпараметров, которые можно исследовать в дальнейшем.

![Контурный график](/docs/images/contour.png)

__График параллельных координат__ -- Этот график позволяет визуализировать все гиперпараметры сразу на одном рисунке. Каждая вертикальная линия — это ось для одного гиперпараметра или целевой функции. Каждая "ниточка", проходящая через все оси, — это одно испытание (trial).

![Контурный график](/docs/images/parallel_coordinates.png)

Всего было запущено 50 триалов. Результаты обучения на графиках ниже.

Accuracy модели:

![Контурный график](/docs/images/TrialAccuracy.png)

Learning rate (применялся lr scheduler):

![Контурный график](/docs/images/TrialLR.png)

Loss модели:

![Контурный график](/docs/images/TrialLoss.png)

Значение EER:

![Контурный график](/docs/images/TrialEER.png)

## Результаты

Итоговый наилучший результат: __EER = 4.1%__.  Набор гиперпараметров, на котором было получено это значение:
```
{
    'emb_size': 2048, 
    'angular_margin': 0.3564995169427794, 
    'angular_scale': 48.1487167638507, 
    'learning_rate': 0.0009063493305418668
}
```